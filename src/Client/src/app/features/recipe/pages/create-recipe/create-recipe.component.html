<div>
  <form [formGroup]="createRecipeForm" (ngSubmit)="submit()">
    <h1>Create Recipe</h1>

    <section>
      <h2>Info</h2>
      <p>
        <label for="title">Title: </label>
        <input id="title" type="text" formControlName="title" required />
      </p>
      <p>
        @if (description) {
          <label for="description">Description: </label>
          <textarea id="description" formControlName="description"></textarea>
          <button type="button" (click)="removeDescription()">-</button>
        } @else {
          <span>Description: </span
          ><button type="button" (click)="addDescription()">+</button>
        }
      </p>
      <p>
        @if (image) {
          <div>
            <img [ngSrc]="previewSrc" alt="Recipe image preview." width="200" height="200" priority>
          </div>
          <label for="image">Image: </label>
          <input id="image" type="file" formControlName="image" (change)="onImagePicked($event)"/>
          <button type="button" (click)="removeImage()">-</button>
        } @else {
          <span>Image: </span
          ><button type="button" (click)="addImage()">+</button>
        }
      </p>
    </section>

    <section class="details">
      <h2>Details</h2>
      <p>
        @if (details.get("prepTime")) {
          <label for="prep-time">Prep Time: </label>
          <input id="prep-time" type="number" formControlName="prepTime" />
          <button class="remove-button" type="button" (click)="removePrepTime()">-</button>
        } @else {
          <span>Prep Time: </span
          ><button class="add-button" type="button" (click)="addPrepTime()">+</button>
        }
      </p>
      <p>
        @if (details.get("cookTime")) {
          <label for="cook-time">Cook Time: </label>
          <input id="cook-time" type="number" formControlName="cookTime" />
          <button class="remove-button" type="button" (click)="removeCookTime()">-</button>
        } @else {
          <span>Cook Time: </span
          ><button class="add-button" type="button" (click)="addCookTime()">+</button>
        }
      </p>
      <p>
        @if (details.get("servings")) {
          <label for="servings">Servings: </label>
          <input id="servings" type="number" formControlName="servings" />
          <button class="remove-button" type="button" (click)="removeServings()">-</button>
        } @else {
          <span>Servings: </span
          ><button class="add-button" type="button" (click)="addServings()">+</button>
        }
      </p>
    </section>

    <section>
      <h2>Nutrition</h2>
      <p>
        @if (nutrition.get("calories")) {
          <label for="calories">Calories: </label>
          <input id="calories" type="number" formControlName="calories" />
          <button type="button" (click)="removeCalories()">-</button>
        } @else {
          <span>Calories: </span
          ><button type="button" (click)="addCalories()">+</button>
        }
      </p>
      <p>
        @if (nutrition.get("fat")) {
          <label for="fat">Fat: </label>
          <input id="fat" type="number" formControlName="fat" />
          <button type="button" (click)="removeFat()">-</button>
        } @else {
          <span>Fat: </span><button type="button" (click)="addFat()">+</button>
        }
      </p>
      <p>
        @if (nutrition.get("carbs")) {
          <label for="carbs">Carbs: </label>
          <input id="carbs" type="number" formControlName="carbs" />
          <button type="button" (click)="removeCarbs()">-</button>
        } @else {
          <span>Carbs: </span
          ><button type="button" (click)="addCarbs()">+</button>
        }
      </p>
      <p>
        @if (nutrition.get("protein")) {
          <label for="protein">Protein: </label>
          <input id="protein" type="number" formControlName="protein" />
          <button type="button" (click)="removeProtein()">-</button>
        } @else {
          <span>Protein: </span
          ><button type="button" (click)="addProtein()">+</button>
        }
      </p>
    </section>

    <section formArrayName="directions">
      <h2>Directions</h2>
      <button type="button" (click)="addDirection()">+</button>

      @for (direction of directions.controls; track direction; let i = $index) {
        <div [formGroupName]="i">
          <h3>Direction {{ i + 1 }}</h3>
          <section>
            <p>
              <label for="description-{{ i }}">Description: </label>
              <textarea
                id="description-{{ i }}"
                formControlName="description"
                required
              ></textarea>
            </p>
          </section>
          <section>
            <p>
              @if (i !== 0) {
                <button type="button" (click)="removeDirection(i)">-</button>
              }
            </p>
          </section>
        </div>
      }
    </section>

    <section formArrayName="tips">
      <h2>Tips</h2>
      <button type="button" (click)="addTip()">+</button>

      @for (tip of tips.controls; track tip; let i = $index) {
        <div>
          <h3>Tip</h3>
          <section>
            <p>
              <label for="description-{{ i }}">Description: </label>
              <textarea
                id="description-{{ i }}"
                formControlName="description"
                required
              ></textarea>
            </p>
          </section>
          <section>
            <p>
              <button type="button" (click)="removeTip(i)">-</button>
            </p>
          </section>
        </div>
      }
    </section>

    <section formArrayName="subIngredients">
      <h2>SubIngredients</h2>
      <button type="button" (click)="addSubIngredient()">+</button>

      @for (
        subIngredient of subIngredients.controls;
        track subIngredient;
        let i = $index
      ) {
        <div [formGroupName]="i">
          <h3>SubIngredient</h3>
          <section>
            <p>
              @if (subIngredient.controls.name) {
                <label for="name">Name: </label>
                <input id="name" type="text" formControlName="name" />
                <button type="button" (click)="removeSubIngredientName(i)">
                  -
                </button>
              } @else {
                <span>Name: </span
                ><button type="button" (click)="addSubIngredientName(i)">
                  +
                </button>
              }
            </p>
          </section>
          <section formArrayName="ingredients">
            <h2>Ingredients</h2>
            <button type="button" (click)="addIngredient(i)">+</button>

            @for (
              ingredient of subIngredient.controls.ingredients.controls;
              track ingredient;
              let j = $index
            ) {
              <div [formGroupName]="j">
                <h3>Ingredient</h3>
                <section>
                  <p>
                    <label for="name-{{ j }}">Name: </label>
                    <input
                      id="name-{{ j }}"
                      type="text"
                      formControlName="name"
                      required
                    />
                  </p>
                  <p>
                    <label for="measurement-{{ j }}">Measurement: </label>
                    <input
                      id="measurement-{{ j }}"
                      type="text"
                      formControlName="measurement"
                      required
                    />
                  </p>
                </section>
                <section>
                  <p>
                    @if (j !== 0) {
                      <button type="button" (click)="removeIngredient(i, j)">
                        -
                      </button>
                    }
                  </p>
                </section>
              </div>
            }
          </section>
          <section>
            <p>
              @if (i !== 0) {
                <button type="button" (click)="removeSubIngredient(i)">
                  -
                </button>
              }
            </p>
          </section>
        </div>
      }
    </section>

    <section>
      <p>
        <button type="submit" [disabled]="isSubmitting">Create</button>
      </p>
    </section>
  </form>
  @if (errorService.messages.length > 0) {
    <section>
      <h2>Errors</h2>

      @for (error of errorService.messages; track error) {
        <p>
          {{ error }}
        </p>
      }
    </section>
  }
</div>
